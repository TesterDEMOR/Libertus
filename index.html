<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Libertus">
  <meta name="description" content="Libertus - Local AI. Private on-device intelligence.">
  <title>Libertus</title>
  <link rel="icon" type="image/svg+xml" href="./favicon.svg">
  <link rel="apple-touch-icon" href="./favicon.svg">
  <link rel="manifest" href="./manifest.json">
</head>
<body>

  <!-- WebGPU not supported overlay -->
  <div class="no-gpu" id="no-gpu">
    <h2>WebGPU Required</h2>
    <p>Libertus needs WebGPU to run AI models locally. Use Chrome 121+, Edge 121+, or another WebGPU-capable browser.</p>
    <p class="no-gpu-hint">On mobile: Chrome for Android 121+</p>
  </div>

  <!-- Setup / Loading screen -->
  <div id="setup-screen">
    <img class="setup-logo" src="./favicon.svg" alt="Libertus">
    <div class="setup-title">Libertus</div>
    <div class="setup-sub">Local AI &mdash; private on-device intelligence</div>
    <div id="s-status" class="setup-status"></div>
    <div class="progress-wrap"><div id="s-bar" class="progress-bar"></div></div>
    <div id="s-detail" class="setup-detail"></div>
    <div id="s-error" class="setup-error"></div>
    <div id="s-alt-btns" class="setup-alt-btns" style="display:none">
      <div class="setup-alt-divider">or download manually:</div>
      <button class="setup-btn" id="s-direct-dl">1. Download model file (~3 GB)</button>
      <button class="setup-btn" id="s-load-file">2. Load downloaded file</button>
    </div>
    <div class="setup-warn">Model is cached for offline use. ~3 GB download. All processing stays on your device.</div>
  </div>

  <!-- Main app -->
  <div id="app">
    <!-- Header -->
    <div class="header">
      <button class="hdr-btn" id="btn-menu" aria-label="Menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div class="header-title" id="hdr-title">New Chat</div>
      <button class="hdr-btn" id="btn-new" aria-label="New Chat">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>

    <!-- Sidebar overlay -->
    <div class="sidebar-overlay" id="sb-overlay"></div>
    <!-- Sidebar -->
    <div class="sidebar" id="sb">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <img src="./favicon.svg" alt="" width="28" height="28">
          Libertus
        </div>
        <button class="sb-close" id="sb-close" aria-label="Close sidebar">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="sidebar-chats" id="sb-chats"></div>
      <div class="sidebar-footer">
        <div class="sidebar-info" id="model-info">Model: not loaded</div>
        <button class="sb-reset" id="btn-backup" style="display:none">Save model to device</button>
        <button class="sb-reset" id="btn-reset">Reset model cache</button>
      </div>
    </div>

    <!-- Messages area -->
    <div class="messages" id="messages">
      <div class="empty" id="empty-state">
        <div class="empty-icon">L</div>
        <h3>Libertus</h3>
        <p>100% private. Your AI runs entirely on this device. No data leaves your browser.</p>
      </div>
    </div>

    <!-- Context bar -->
    <div class="ctx-bar" id="ctx-bar" style="display:none">
      <span class="ctx-dot g" id="ctx-dot"></span>
      <span id="ctx-text">Context: 0 / 0</span>
    </div>

    <!-- Input bar -->
    <div class="input-bar">
      <div class="input-wrap">
        <textarea id="user-input" rows="1" placeholder="Message Libertus..."></textarea>
      </div>
      <button class="send-btn" id="send-btn" disabled aria-label="Send">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
  </div>

  <!-- pwa-install component (bundled via npm) -->
  <pwa-install
    id="pwa-install"
    manifest-url="./manifest.json"
    name="Libertus"
    description="Local AI â€” private on-device intelligence"
    icon="./favicon.svg"
  ></pwa-install>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
